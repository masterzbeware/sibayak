--[[
    FUNGSI:
    - Menampilkan GUI TextBox untuk ketik nama pemain
    - Cari player berdasarkan DisplayName atau Username
    - Tenda akan mengikuti pergerakan player tersebut
--]]

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

-- BUAT GUI
local screenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
screenGui.Name = "TendaFollowerGUI"

local textBox = Instance.new("TextBox", screenGui)
textBox.Size = UDim2.new(0, 300, 0, 50)
textBox.Position = UDim2.new(0.5, -150, 0, 100)
textBox.PlaceholderText = "Masukkan Username atau DisplayName"
textBox.Text = ""
textBox.Font = Enum.Font.SourceSansBold
textBox.TextSize = 20
textBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
textBox.TextColor3 = Color3.fromRGB(255, 255, 255)
textBox.ClearTextOnFocus = false

-- FUNGSI HAPUS TENDA
local function deleteTenda()
    local args = {
        "uxrDeleteEvent",
        "Tenda"
    }
    ReplicatedStorage:WaitForChild("uxrPlacementSystem#RS@4.0")
        :WaitForChild("placementEvents"):WaitForChild("RemoteEvent")
        :FireServer(unpack(args))
end

-- FUNGSI SPAWN TENDA DI POSISI
local function spawnTendaAt(pos)
    local args = {
        "uxrPlaceEvent",
        "Tenda",
        pos.X,
        pos.Y,
        pos.Z,
        0.538154125213623, 0, 0.8428464531898499,
        0, 1, 0,
        -0.8428464531898499, 0, 0.538154125213623
    }
    ReplicatedStorage:WaitForChild("uxrPlacementSystem#RS@4.0")
        :WaitForChild("placementEvents"):WaitForChild("RemoteEvent")
        :FireServer(unpack(args))
end

-- CEK APAKAH POSISI BERUBAH
local function hasMoved(lastPos, newPos)
    return (lastPos - newPos).Magnitude > 1
end

-- FUNGSI FOLLOW PLAYER TARGET
local function followTargetPlayer(targetPlayer)
    local char = targetPlayer.Character or targetPlayer.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    local lastPos = hrp.Position

    spawnTendaAt(lastPos)

    while targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") do
        wait(0.5)
        local newPos = targetPlayer.Character.HumanoidRootPart.Position
        if hasMoved(lastPos, newPos) then
            deleteTenda()
            spawnTendaAt(newPos)
            lastPos = newPos
        end
    end
end

-- KETIKA ENTER DITEKAN DI TEXTBOX
textBox.FocusLost:Connect(function(enterPressed)
    if enterPressed then
        local input = textBox.Text:lower()
        local targetPlayer = nil

        for _, player in ipairs(Players:GetPlayers()) do
            if player.Name:lower() == input or player.DisplayName:lower() == input then
                targetPlayer = player
                break
            end
        end

        if targetPlayer then
            spawn(function()
                followTargetPlayer(targetPlayer)
            end)
        else
            warn("Pemain tidak ditemukan:", input)
        end
    end
end)
