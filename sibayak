-- ‚úÖ Obsidian UI Setup
local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()

Library.ForceCheckbox = false
Library.ShowToggleFrameInKeybinds = true

local Window = Library:CreateWindow({
    Title = "Tenda Follower UI",
    Footer = "by MasterZ",
    Icon = 0,
    NotifySide = "Right",
    ShowCustomCursor = true,
})

local Tabs = {
    Main = Window:AddTab("Main", "user")
}

local GroupBox = Tabs.Main:AddLeftGroupbox("Tenda Follow")
local CallBox = Tabs.Main:AddRightGroupbox("Spam Telepon")
local CarryBox = Tabs.Main:AddLeftGroupbox("Carry Request") -- ‚úÖ GroupBox ke-3
local CallingLabel = CallBox:AddLabel("Sedang menelepon: -")

-- ‚úÖ Variable Global
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

local running = false
local currentFollowThread = nil
local targetName = ""
local followDelay = 0.5
local carryRunning = false

-- ‚úÖ Fungsi Dapatkan Daftar Pemain
local function getPlayerNames()
    local list = {}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            table.insert(list, player.DisplayName .. " [" .. player.Name .. "]")
        end
    end
    return list
end

-- ‚úÖ Fungsi Hapus Tenda
local function deleteTenda()
    local args = { "uxrDeleteEvent", "Tenda" }
    ReplicatedStorage:WaitForChild("uxrPlacementSystem#RS@4.0")
        :WaitForChild("placementEvents"):WaitForChild("RemoteEvent")
        :FireServer(unpack(args))
end

-- ‚úÖ Fungsi Spawn Tenda
local function spawnTendaAt(pos)
    local args = {
        "uxrPlaceEvent", "Tenda",
        pos.X, pos.Y, pos.Z,
        0.538154125213623, 0, 0.8428464531898499,
        0, 1, 0,
        -0.8428464531898499, 0, 0.538154125213623
    }
    ReplicatedStorage:WaitForChild("uxrPlacementSystem#RS@4.0")
        :WaitForChild("placementEvents"):WaitForChild("RemoteEvent")
        :FireServer(unpack(args))
end

-- ‚úÖ Cek Gerakan
local function hasMoved(lastPos, newPos)
    return (lastPos - newPos).Magnitude > 1
end

-- ‚úÖ Fungsi Utama: Ikuti Target
local function followTargetPlayer(targetPlayer)
    local char = targetPlayer.Character or targetPlayer.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    local lastPos = hrp.Position

    spawnTendaAt(lastPos)

    while running and targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") do
        task.wait(followDelay)
        local newPos = targetPlayer.Character.HumanoidRootPart.Position
        if hasMoved(lastPos, newPos) then
            deleteTenda()
            spawnTendaAt(newPos)
            lastPos = newPos
        end
    end
end

-- ‚úÖ TextBox Nama Target
GroupBox:AddInput("TargetName", {
    Default = "",
    Numeric = false,
    Finished = false,
    Text = "Nama Target Manual",
    Tooltip = "Masukkan DisplayName/Username target",
    Placeholder = "Contoh: Player123",
    Callback = function(value)
        targetName = value
    end
})

-- ‚úÖ Dropdown Target
local playerDropdown = GroupBox:AddDropdown("TargetDropdown", {
    Values = getPlayerNames(),
    Multi = false,
    Text = "Pilih Target dari List",
    Tooltip = "Lebih mudah pilih pemain langsung",
    Callback = function(value)
        local name = string.match(value, "%[(.-)%]$") -- ambil Username dari [Username]
        if name then
            targetName = name
        end
    end
})

-- ‚úÖ Tombol Refresh Dropdown
GroupBox:AddButton("üîÑ Refresh Player List", function()
    local newList = getPlayerNames()
    playerDropdown:SetValues(newList)
    Library:Notify("‚úÖ Daftar pemain diperbarui!", 3)
end)

-- ‚úÖ TextBox Delay Kecepatan
GroupBox:AddInput("FollowDelay", {
    Default = "0.5",
    Numeric = false,
    Finished = true,
    Text = "Delay (detik)",
    Tooltip = "Delay pergerakan tenda mengikuti target",
    Placeholder = "Contoh: 0.2",
    Callback = function(value)
        local num = tonumber(value)
        if num then followDelay = num end
    end
})

-- ‚úÖ Tombol Cancel
GroupBox:AddButton("Cancel Follow", function()
    running = false
    deleteTenda()
    Library:Notify("‚õî Follow dihentikan & tenda dihapus", 3)
end)

-- ‚úÖ Toggle Aktif
GroupBox:AddToggle("FollowTenda", {
    Text = "Aktifkan Follow Tenda",
    Default = false,
    Tooltip = "Tenda akan mengikuti target yang dimasukkan",
    Callback = function(state)
        running = state
        if state then
            if targetName == "" then
                Library:Notify("‚ùó Masukkan atau pilih nama target terlebih dahulu", 3)
                return
            end

            local targetPlayer = nil
            for _, player in ipairs(Players:GetPlayers()) do
                if player.Name:lower() == targetName:lower() or player.DisplayName:lower() == targetName:lower() then
                    targetPlayer = player
                    break
                end
            end

            if targetPlayer then
                Library:Notify("‚úÖ Mulai mengikuti: " .. targetPlayer.Name, 3)
                currentFollowThread = task.spawn(function()
                    followTargetPlayer(targetPlayer)
                end)
            else
                Library:Notify("‚ùå Player tidak ditemukan", 3)
            end
        else
            running = false
            deleteTenda()
            Library:Notify("‚õî Follow dimatikan & tenda dihapus", 3)
        end
    end,
})

-- ‚úÖ Fungsi: Spam Invite ke semua player
local function spamInviteAll()
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local callingName = player.DisplayName .. " [" .. player.Name .. "]"
            CallingLabel:SetText("Sedang menelepon: " .. callingName)

            local args = {
                "Phone",
                "InviteToRoom",
                player
            }
            ReplicatedStorage:WaitForChild("EdenShared"):WaitForChild("Modules"):WaitForChild("Remote"):WaitForChild("RemoteFunction"):InvokeServer(unpack(args))
            task.wait(0.2)
        end
    end
    CallingLabel:SetText("‚úÖ Selesai menelepon semua")
    Library:Notify("üìû Invite terkirim ke semua pemain", 3)
end

-- ‚úÖ Fungsi: Leave Room
local function leaveRoom()
    local args = {
        "Phone",
        "LeaveRoom"
    }
    ReplicatedStorage:WaitForChild("EdenShared"):WaitForChild("Modules"):WaitForChild("Remote"):WaitForChild("RemoteEvent"):FireServer(unpack(args))
    Library:Notify("üö™ Keluar dari Room", 3)
end

-- ‚úÖ Tombol di GroupBox Telepon
CallBox:AddButton("üìû Spam Invite ke Semua", spamInviteAll)
CallBox:AddButton("üö™ Leave Room", leaveRoom)
CallBox:AddButton("‚ùå Clear Info", function()
    CallingLabel:SetText("Sedang menelepon: -")
end)

-- ‚úÖ Hentikan follow jika target keluar dari game
Players.PlayerRemoving:Connect(function(leavingPlayer)
    if running and targetName ~= "" then
        if leavingPlayer.Name:lower() == targetName:lower() or leavingPlayer.DisplayName:lower() == targetName:lower() then
            running = false
            deleteTenda()
            Library:Notify("üö™ Target keluar, follow otomatis dihentikan", 3)
        end
    end
end)

-- ‚úÖ Fungsi: Spam Carry ke Semua Pemain
local function spamCarryAll()
    carryRunning = true
    for _, player in ipairs(Players:GetPlayers()) do
        if not carryRunning then break end
        if player ~= LocalPlayer then
            local args = {
                "Request",
                player
            }
            ReplicatedStorage:WaitForChild("CarryRequest"):FireServer(unpack(args))
            Library:Notify("üì¶ Mengirim carry ke: " .. player.DisplayName, 2)
            task.wait(0.4)
        end
    end
    carryRunning = false
    Library:Notify("‚úÖ Selesai spam carry ke semua", 3)
end

-- ‚úÖ Fungsi: Membatalkan Carry
local function cancelCarry()
    carryRunning = false
    local args = {
        "Clavswoshy"
    }
    ReplicatedStorage:WaitForChild("CarryRequest"):FireServer(unpack(args))
    Library:Notify("‚ùå Carry request dibatalkan", 3)
end

-- ‚úÖ Tombol di GroupBox Carry
CarryBox:AddButton("üì¶ Spam Carry ke Semua", spamCarryAll)
CarryBox:AddButton("‚ùå Cancel Carry Request", cancelCarry)
